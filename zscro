#!/usr/bin/env -S java --source 25

enum Log {

    ERROR(Color.BRIGHT_RED, System.err),
    USER(Color.BRIGHT_WHITE, System.out),
    INFO(Color.BRIGHT_GREEN, System.out),
    SYSTEM(Color.SKY_BLUE, System.out),
    WARNING(Color.WARM_YELLOW, System.out),
    DEBUG(Color.SOFT_PURPLE, System.out);

    PrintStream out;

    enum Color {
        SOFT_GRAY("\033[38;5;246m"),      // Soft gray
        WARM_YELLOW("\033[38;5;220m"),        // Warm yellow
        BRIGHT_BLUE("\033[38;5;33m"),     // Bright blue
        BRIGHT_WHITE("\033[38;5;255m"),      // Bright white
        BRIGHT_RED("\033[38;5;196m"),         // Bright red
        BRIGHT_GREEN("\033[38;5;46m"),        // Bright green
        BRIGHT_YELLOW("\033[38;5;226m"),      // Bright yellow
        SKY_BLUE("\033[38;5;39m"),         // Sky blue
        SOFT_PURPLE("\033[38;5;129m"),      // Soft purple
        BRIGHT_CYAN("\033[38;5;51m"),         // Bright cyan
        BLACK_ON_WHITE("\033[38;5;232;48;5;255m");  // Black text on white background

        String code;

        Color(String code) {
            this.code = code;
        }
    }

    private final String value;
    private final static String RESET = "\u001B[0m";

    private Log(Color color, PrintStream out) {
        this.value = (color.code + "%s" + RESET);
        this.out = out;
    }

    public String formatted(String raw) {
        return this.value.formatted(raw);
    }

    public void out(String message) {
        var colored = formatted(message);
        this.out.println(colored);
    }

    public static void debug(String message) {
        Log.DEBUG.out(message);
    }

    public static void error(String message) {
        Log.ERROR.out(message);
    }

    public static void error(String message, Exception e) {
        Log.ERROR.out(message + ": " + e.getMessage());
        e.printStackTrace(System.err);
    }

    public static void user(String message){
        Log.USER.out(message);
    }

    public static void clearScreen(){
        IO.println("\033c");
    }


    public static void warning(String message){
        Log.WARNING.out(message);
    }

    public static void stop(String message){
        error(message);
        System.exit(0);
    }
}

void main (String ...args) {
    if (args.length == 0) {
        Log.stop("Usage: zscro <filename>");
    }

    var filename = args[0];
    var pathEnv = System.getenv("PATH");

    if (pathEnv == null || pathEnv.isBlank()) {
        Log.stop("PATH environment variable is not set");
    }

    var separator = System.getProperty("path.separator");
    var found = Stream.of(pathEnv.split(separator))
            .map(Path::of)
            .map(dir -> dir.resolve(filename))
            .filter(Files::exists)
            .filter(Files::isRegularFile)
            .findFirst();

    if (found.isEmpty()) {
        Log.stop("File not found in PATH: " + filename);
    }

    try {
        Files.lines(found.get()).forEach(Log::user);
    } catch (IOException e) {
        Log.stop("Error reading file: " + e.getMessage());
    }
}

